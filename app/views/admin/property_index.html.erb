<div class="container py-5">

  <div class="row">
    <div class="col-12">
      <ul id="sidebar" class="list-unstyled d-flex">
        <li class="text-center text-lg-left flex-fill">
          <a class="text-info bg-light d-block py-2 pl-lg-3 mb-2 account-tabs active" href="<%= admin_properties_path %>">Properties<br></a>
        </li>
        <li class="text-center text-lg-left flex-fill">
          <a class="text-info bg-light d-block py-2 pl-lg-3 mb-2 account-tabs" href="#">Users<br></a>
        </li>
        <li class="text-center text-lg-left flex-fill">
          <a class="text-info bg-light d-block py-2 pl-lg-3 mb-2 account-tabs" href="">Accounts<br></a>
        </li>
        <li class="text-center text-lg-left flex-fill">
          <a class="text-info bg-light d-block py-2 pl-lg-3 mb-2 account-tabs" href="#">Investments<br></a>
        </li>
      </ul>
    </div>

		<div class="col">
			<div class="border rounded p-4">
        <div class="text-right mB-4">
          <%= link_to 'NEW PROPERTY', admin_new_property_path, class: "btn btn-info ml-md-2 button-block" %>
        </div>
        <hr>
        <div>
          <div class="table-responsive">
  					<table id="invTable" class="table table-hover table-bordered" style="width:100%">
  						<thead class="thead-light">
  							<tr>
  								<th></th>
  								<th>Date</th>
  								<th>Thumbnail</th>
  								<th>PID</th>
  								<th>Name</th>
  								<th>Units Sold</th>
  								<th>Unit Price</th>
  								<th>Status</th>
  								<th></th>
  							</tr>
  						</thead>
  					</table>
  				</div>
        </div>
			</div>
		</div>
	</div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net/1.10.21/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/dataTables.bootstrap4.min.js"></script>

<script type="text/javascript">
	data = <%== @properties.to_json %>;

	$(document).ready(function () {
    console.log(data)
		let table = $('#invTable').DataTable({
			data: data,
			columns: [
				{ data: null },
				{ data: 'created_at',
				  	render: function(data, type, row){
						let dateSplit = data.split('-');
						let daySplit = dateSplit[2].split('T');
						return type === "display" || type === "filter" ?
							daySplit[0] + '/' + dateSplit[1] + '/' + dateSplit[0] :
							data;
				  	}
				},
				{ data: 'prop_image',
          render: function(data, type, row){
            return '<img src="' + data + '" width="100px">'
          }
        },
				{ data: 'prop_id' },
				{ data: 'name',
				  render: function(data, type, row){
					  return '<u><a href="/properties/' + row.id + '" target=_blank>' + data + '</a></u>'
				  }
				},
				{ data: null,
          render: function(data, type, row){
            return row.total_shares - row.available_shares + ' of ' + row.total_shares
          }
        },
				{ data: null,
				  render: function(data, type, row){
					  return '$ ' + formatPrice(row.value/row.total_shares)
				  }
				},
        { data: 'status' },
        { data: null,
          render: function(data, type, row){
            return '<div class="btn-group">' +
              '<button type="button" class="btn btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
                '<i class="fas fa-ellipsis-h"></i>' +
              '</button>' +
              '<div class="dropdown-menu dropdown-menu-right">' +
                '<a class="dropdown-item" href="/admin/properties/'+ row.id + '/edit">Edit</a>'+
                '<div class="dropdown-divider"></div>'+
                '<a class="dropdown-item" href="/admin/properties/'+ row.id + '">Delete</a>'+
              '</div>'+
            '</div>'
          }
        }
			],

			"columnDefs": [ {
				"searchable": false,
				"orderable": false,
				"targets": 0
				},
				{className: "td-text-right", targets: 6},
				{ width: "130px", targets: 2}
			],

			"order": [[ 1, 'dsc' ]]
		});

		table.on( 'order.dt search.dt', function () {
			table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
				cell.innerHTML = i+1;
			});
		})
		.draw()
		.columns.adjust()
		// .responsive.recalc();
	});

	function formatPrice(val){
		const formatter = new Intl.NumberFormat('en-US', {
		  minimumFractionDigits: 2,
		  maximumFractionDigits: 2
		});

		return formatter.format(val);
	}
</script>
